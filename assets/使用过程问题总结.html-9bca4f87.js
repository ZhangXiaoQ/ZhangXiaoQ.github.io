import{_ as l,W as i,X as o,Y as e,Z as a,a0 as t,a2 as c,C as r}from"./framework-a9f5de78.js";const s={},p={href:"http://mp.weixin.qq.com/s?__biz=MzI5MDg2NjEzNA==&mid=2247489493&idx=1&sn=223d54bd1db81f39e3b1f50f66d2a9be&chksm=ec18016cdb6f887a16ad62a7251ac1ca3edcc5e00f38d1abd443fe26c44e565e1ffde00c7019&token=1559559504&lang=zh_CN#rd",target:"_blank",rel:"noopener noreferrer"},d=c(`<p>今天我们抛开 canal 的原理和代码不谈，总结几个在使用过程中遇到的问题，当然，解决方案也一并呈上。</p><h2 id="问题一" tabindex="-1"><a class="header-anchor" href="#问题一" aria-hidden="true">#</a> 问题一</h2><p>在给 canal 分配数据库权限的过程中，由于密码设置的比较简单，会报以下错误</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这是由 MySQL 的密码规范决定的，建议设置的密码要包含大小写字母、数字和特殊字符，具体的规范大家可以自行百度😃。</p><h2 id="问题二" tabindex="-1"><a class="header-anchor" href="#问题二" aria-hidden="true">#</a> 问题二</h2><p>在通过命令<code>./bin/startup.sh</code> 启动 canal 服务后，发现在 logs 下没有生成 canal.log 日志，在进程命令中 <code>ps -ef | grep canal</code> 也查不到 canal 的进程。</p><p>通过查看目录 logs 下的文件 <code>canal_stdout.log</code>，发现了问题所在</p><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/49d6f29fab834117a2cb774068def16e~tplv-k3u1fbpfcp-zoom-1.image" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>报错信息提示内存不足，Java 运行时环境无法继续。更详细的错误日志在文件：<code>/usr/local/bin/hs_err_pid25186.log</code> 中。</p><p>既然是内存原因，那就检查一下自己的内存，执行命令<code>free -h</code> ，发现可用内存仅为 96M，应该是内存问题，解决方法如下：</p><ul><li>杀死运行的一些进程；</li><li>增加虚拟机的内存；</li><li>修改 canal 启动时所需要的内存；</li></ul>`,12),f={href:"http://startup.sh",target:"_blank",rel:"noopener noreferrer"},h=e("figure",null,[e("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3231e6487c0d4ace9544dec7ae68cffe~tplv-k3u1fbpfcp-watermark.image?",alt:"2内存配置.png",tabindex:"0",loading:"lazy"}),e("figcaption",null,"2内存配置.png")],-1),u=e("p",null,[a("改为 "),e("code",null,"-server -Xms80m -Xmx80m -Xmn80m -XX:SurvivorRatio=2 -XX:PermSize=66m -XX:MaxPermSize=80m -Xss256k -XX:-UseAdaptiveSizePolicy -XX:MaxTenuringThreshold=15 -XX:+DisableExplicitGC -XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -XX:+UseCMSInitiatingOccupancyOnly -XX:+HeapDumpOnOutOfMemoryError")],-1),g=e("code",null,"found canal.pid , Please run stop.sh first ,then startup.sh ",-1),m={href:"http://xn--stop-ko8f1720a0mfgri.sh",target:"_blank",rel:"noopener noreferrer"},_=e("blockquote",null,[e("p",null,"这是由于 canal 服务不正常退出服务导致的，比如说虚拟机强制重启。")],-1),b={href:"http://stop.sh",target:"_blank",rel:"noopener noreferrer"},x=c('<figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb5f90ebf07141b19f24daff30a0e9ef~tplv-k3u1fbpfcp-watermark.image?" alt="3canal日志.png" tabindex="0" loading="lazy"><figcaption>3canal日志.png</figcaption></figure><h2 id="问题三" tabindex="-1"><a class="header-anchor" href="#问题三" aria-hidden="true">#</a> 问题三</h2><p>在 canal 服务启动之后，想通过编写代码的方式来测试数据库变更之后触发 canal 输出数据的过程。结果无论怎样修改，控制台就是没有日志打出。</p><p>通过查看 canal <code>/usr/local/logs/example</code>下的 example.log 文件才发现问题所在</p><figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0338cba865754edfb5ae77bd5e00e736~tplv-k3u1fbpfcp-watermark.image?" alt="4实例ip配置不对.jpg" tabindex="0" loading="lazy"><figcaption>4实例ip配置不对.jpg</figcaption></figure><p>原因就是<code>meta.dat</code>中保存的位点信息和数据库的位点信息不一致导致 canal 抓取不到数据库的动作。</p><p>于是我找到 canal 的 <code>conf/example/instance.properties</code> 实例配置文件，发现没有将<code>canal.instance.master.address=127.0.0.1:3306 </code>设置成自己的数据库地址。</p><h3 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案" aria-hidden="true">#</a> 解决方案</h3><ul><li>先停止 canal 服务的运行；</li><li>删除<code>meta.dat</code>文件；</li><li>再重启canal，问题解决；</li></ul>',9);function k(X,v){const n=r("ExternalLinkIcon");return i(),o("div",null,[e("p",null,[a("前几天在网上冲浪的时候发现了一个比较成熟的开源中间件——Canal。在了解了它的工作原理和使用场景后，顿时产生了浓厚的兴趣。本着好记性不如烂笔头的原则，阿Q对 Canal 的原理进行了梳理、对环境进行了搭建，具体步骤见这篇文章："),e("a",p,[a("原理+配置+实战，Canal一套带走"),t(n)])]),d,e("p",null,[a("我就是用的第三种方法，首先用 vim 打开 "),e("a",f,[a("startup.sh"),t(n)]),a(" 修改内存参数，可以对照我的进行修改，按照自己服务器剩余内存进行修改，这里我将内存调整到了 80M。")]),h,u,e("p",null,[a("改完之后执行命令发现依旧报错："),g,a("意思是找到了 canal.pid，"),e("a",m,[a("请先运行stop.sh"),t(n)])]),_,e("p",null,[a("执行 "),e("a",b,[a("stop.sh"),t(n)]),a(" 命令后重新启动，成功运行，成功运行后可以在 canal/logs 文件夹中生成 canal.log 日志。")]),x])}const z=l(s,[["render",k],["__file","使用过程问题总结.html.vue"]]);export{z as default};
