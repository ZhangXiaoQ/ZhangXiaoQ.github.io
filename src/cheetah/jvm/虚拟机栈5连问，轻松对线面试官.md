---
title: è™šæ‹Ÿæœºæ ˆ5è¿é—®ï¼Œè½»æ¾å¯¹çº¿é¢è¯•å®˜
icon: storage
order: 5
category:
  - JVM
tag:
  - è™šæ‹Ÿæœºæ ˆ
  - æ€»ç»“
---

## é¢è¯•è·¯ä¸Š

  ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2ea6159dcc14a02a1d579096b428743~tplv-k3u1fbpfcp-zoom-1.image)

â€œæ»´ï¼Œæ»´æ»´......â€å¸ˆå‚…æˆ‘ä»¬åˆ°å“ªäº†ï¼Ÿæˆ‘è¿˜è¦èµ¶ç€é¢è¯•å‘¢ã€‚

**å¸ˆå‚…ï¼š** å¿«äº†å¿«äº†ï¼Œä¸‹ä¸ªè·¯å£å°±åˆ°äº†ã€‚çœŸæ˜¯æœäº†è¿™å¸®äººäº†ï¼Œä¸ä¼šå¼€è½¦å‡€å¾€é‡Œå‡‘ã€‚

å¬ç€å¸æœºå¸ˆå‚…çš„æŠ±æ€¨å£°ï¼Œä¸ç¦æƒ³èµ·é¦–æ‰“æ²¹è¯—ï¼šæ»¡ç›®å°¾ç¯çº¢ï¼Œè€³ç›ˆåˆºç¬›å£°ã€‚å¿ƒå¿§è¿Ÿåˆ°ä¹…ï¼Œé¢“é¦–ä¼¼é›·è½°ã€‚

ä¸€ä¸‹è½¦èµ¶ç´§å°è·‘å°±è¿›äº†å¯Œä¸½å ‚çš‡çš„é…’åº—ï¼Œä¸ä¸ä¸ï¼Œæ˜¯å•†åŠ¡æ¥¼ï¼Œè¿™å¤§å…æœ‰ç‚¹æ°”æ´¾ï¼Œè®©æˆ‘æœ‰ç‚¹æƒ³å…¥ééå‘€ã€‚

## **é¢è¯•ç»è¿‡** 

â€œå’šå’šå’šâ€ï¼Œâ€œè¯·è¿›â€ã€‚

**é¢è¯•å®˜ï¼š** å°ä¼™å­é•¿å¾—æŒºå¸…å‘€ï¼Œå¹´è½»äººå°±æ˜¯æœ‰æ´»åŠ›ï¼Œæ¥å…ˆåšä¸ªç®€å•çš„è‡ªæˆ‘ä»‹ç»å§ã€‚

**é˜¿Qï¼š** é¢è¯•å®˜ä½ å¥½ï¼ŒMy name is â€œå½±æµä¹‹ä¸»â€ï¼Œæ¥è‡ªè‰¾æ¬§å°¼äºšï¼Œæ˜¯`LOL`ä¸­çš„æœ€å¼ºä¸­å•ï¼ˆä¸æ¥å—åé©³ï¼‰ï¼Œè®ºå•æ€æ²¡æœ‰æœè¿‡è°ã€‚æˆ‘çš„å£å¤´ç¦…æ˜¯â€œæ— å½¢ä¹‹åˆƒï¼Œæœ€ä¸ºè‡´å‘½â€ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥å«æˆ‘é˜¿Qï¼Œè¿™æ˜¯æˆ‘çš„ç®€å†ã€‚

  ![ç®€å†](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9bf31fc1d4ee4e12b8ff0b2cd48a6dd4~tplv-k3u1fbpfcp-zoom-1.image)

**é¢è¯•å®˜ï¼š** é˜¿Qï¼Œé‚£å’±ä¹Ÿä¸å¯’æš„äº†ï¼Œç›´æ¥åˆ‡æ­£é¢˜å§ã€‚çœ‹ä½ `jvm`å†™çš„çŸ¥è¯†ç‚¹æœ€å¤šï¼Œé‚£å°±å…ˆè¯´ä¸€ä¸‹ä½ å¯¹è™šæ‹Ÿæœºæ ˆçš„ç†è§£å§ã€‚

**é˜¿Qï¼š** å†…å¿ƒOSï¼šè¿™æ³¢å¯ä»¥å¹Xäº†ã€‚å’³...å’³...è™šæ‹Ÿæœºæ ˆæ—©æœŸä¹Ÿå«`java`æ ˆï¼Œæ˜¯åœ¨`jvm`çš„è¿è¡Œæ—¶æ•°æ®åŒºå­˜åœ¨çš„ä¸€å—å†…å­˜åŒºåŸŸã€‚å®ƒæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œéšçº¿ç¨‹åˆ›å»ºè€Œåˆ›å»ºï¼Œéšçº¿ç¨‹æ¶ˆäº¡è€Œç»“æŸã€‚

å—¯ã€‚ã€‚ã€‚å‡è£…æƒ³ä¸€ä¸‹ğŸ˜„

ä¼—æ‰€å‘¨çŸ¥ï¼Œæ ˆåªæœ‰è¿›æ ˆå’Œå‡ºæ ˆä¸¤ç§æ“ä½œï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ç§å¿«é€Ÿæœ‰æ•ˆçš„åˆ†é…å­˜å‚¨æ–¹å¼ã€‚å¯¹äºå®ƒæ¥è¯´ï¼Œå®ƒä¸å­˜åœ¨åƒåœ¾å›æ”¶é—®é¢˜ï¼Œä½†æ˜¯å®ƒçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…å›ºå®šä¸å˜çš„ï¼Œå› æ­¤å®ƒä¼šå­˜åœ¨æ ˆæº¢å‡ºæˆ–è€…å†…å­˜æº¢å‡ºé—®é¢˜......

**é¢è¯•å®˜:** æ‰“æ–­ä¸€ä¸‹å•Šï¼Œä½ åˆšæ‰è¯´ä¼šå­˜åœ¨æ ˆæº¢å‡ºå’Œå†…å­˜æº¢å‡ºé—®é¢˜ï¼Œé‚£ä½ èƒ½åˆ†åˆ«è¯´ä¸€ä¸‹ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå—ï¼Ÿ

**é˜¿Qï¼š** å¯ä»¥å¯ä»¥ï¼Œæˆ‘ä»¬çŸ¥é“è™šæ‹Ÿæœºæ ˆç”±æ ˆå¸§ç»„æˆï¼Œæ¯ä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨éƒ½å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§çš„å…¥æ ˆã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`-Xss`å‚æ•°æ¥è®¾ç½®æ ˆçš„å¤§å°ï¼Œå‡è®¾æˆ‘ä»¬è®¾ç½®çš„è™šæ‹Ÿæœºæ ˆå¤§å°å¾ˆå°ï¼Œå½“æˆ‘ä»¬è°ƒç”¨çš„æ–¹æ³•è¿‡å¤šï¼Œä¹Ÿå°±æ˜¯æ ˆå¸§è¿‡å¤šçš„è¯ï¼Œå°±ä¼šå‡ºç°`StackOverflowError`ï¼Œå³æ ˆæº¢å‡ºé—®é¢˜ã€‚

å‡å¦‚æˆ‘ä»¬çš„æ ˆå¸§ä¸å›ºå®šï¼Œè®¾ç½®ä¸ºåŠ¨æ€æ‰©å±•çš„ï¼Œé‚£åœ¨æˆ‘ä»¬çš„å†…å­˜ä¸è¶³æ—¶ï¼Œä¹Ÿå°±æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥æ”¯æŒæ ˆçš„æ‰©å±•ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå‡ºç°`OOM`å¼‚å¸¸ï¼Œå³å†…å­˜æº¢å‡ºé—®é¢˜ã€‚

**é¢è¯•å®˜:** å—¯å—¯ï¼ˆç‚¹å¤´çŠ¶ï¼‰ï¼Œç¤ºæ„å°ä¼™å­æ€è·¯å¾ˆæ¸…æ™°å‘€ï¼Œé‚£ä½ åˆšæ‰è¯´åˆ°æ ˆå¸§è®¾ç½®çš„å¤ªå°ä¼šå¯¼è‡´æ ˆå¸§æº¢å‡ºé—®é¢˜ï¼Œé‚£æˆ‘ä»¬è®¾ç½®çš„å¤§ç‚¹ä¸å°±å¯ä»¥å®Œå…¨é¿å…æ ˆæº¢å‡ºäº†å˜›ã€‚

**é˜¿Qï¼š** ä¸€å¬å°±æ˜¯è¦ç»™æˆ‘æŒ–å‘å‘€ï¼Œåƒæˆ‘ä»¬ä¸€èˆ¬éƒ½æ¯”è¾ƒå´‡å°šä¸­åº¸ä¹‹é“ï¼Œæ‰€ä»¥ä¸€å¬åˆ°è¿™ç§ç»å¯¹çš„é—®é¢˜ï¼Œå¿…é¡»æœºçµç‚¹ï¼šä¸ä¸ä¸ï¼Œè°ƒæ•´æ ˆçš„å¤§å°åªå¯ä»¥**å»¶ç¼“**æ ˆæº¢å‡ºçš„æ—¶é—´æˆ–è€…è¯´å‡å°‘æ ˆæº¢å‡ºçš„é£é™©ã€‚

### ä¸¾ä¸ªğŸŒ°å§

1. å‡å¦‚ä¸€ä¸ªä¸šåŠ¡é€»è¾‘çš„æ–¹æ³•è°ƒç”¨éœ€è¦`5000`æ¬¡ï¼Œä½†æ˜¯æ­¤æ—¶æŠ›å‡ºäº†æ ˆæº¢å‡ºçš„é”™è¯¯ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®`-Xss`æ¥è·å–æ›´å¤§çš„æ ˆç©ºé—´ï¼Œä½¿å¾—è°ƒç”¨åœ¨`7000`æ¬¡æ—¶æ‰ä¼šæº¢å‡ºã€‚æ­¤æ—¶è°ƒæ•´æ ˆå¤§å°å°±å˜å¾—å¾ˆæœ‰æ„ä¹‰ï¼Œå› ä¸ºè¿™æ ·å°±ä¼šä½¿å¾—ä¸šåŠ¡èƒ½æ­£å¸¸æ”¯æŒã€‚
2. é‚£å‡å¦‚æ˜¯æœ‰**æ­»é€’å½’**çš„æƒ…å†µåˆ™æ— è®ºæ€ä¹ˆæé«˜æ ˆå¤§å°éƒ½ä¼šæº¢å‡ºï¼Œè¿™æ ·ä¹Ÿå°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ã€‚

**é¢è¯•å®˜:** å¥½çš„ï¼Œé‚£ä½ çœ‹ä¸€ä¸‹è¿™ä¸ªç®€å•çš„å°ç¨‹åºï¼Œä½ èƒ½å¤§ä½“è¯´ä¸€ä¸‹å®ƒåœ¨å†…å­˜ä¸­çš„æ‰§è¡Œè¿‡ç¨‹å—ï¼Ÿ

```
 public void test() {
      byte i = 15;
      int j = 8;
      int k = i + j;
}
```

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/438b702128514f3b9b72b9da40276b7d~tplv-k3u1fbpfcp-zoom-1.image)

### æ¥å¼ å›¾ï¼Œä¾¿äºå¤§å®¶æ›´å¥½åœ°ç†è§£

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0913ce955d34eb18a33aa355c5b4ad4~tplv-k3u1fbpfcp-zoom-1.image)

**é˜¿Qï¼š**  å…ˆæŠŠè¯¥ä»£ç ç¼–è¯‘ä¸€ä¸‹ï¼Œç„¶åæŸ¥çœ‹å®ƒçš„å­—èŠ‚ç æ–‡ä»¶ã€‚å¦‚ä¸Šå›¾ä¸­å·¦è¾¹æ‰€ç¤ºï¼Œæ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š

1. é¦–å…ˆå°†è¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€`0`å­˜æ”¾åˆ°`PC`å¯„å­˜å™¨ä¸­ï¼Œæ­¤æ—¶ï¼Œå±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆçš„æ•°æ®ä¸ºç©ºï¼›
2. å½“æ‰§è¡Œç¬¬ä¸€æ¡æŒ‡ä»¤`bipush`æ—¶ï¼Œå°†æ“ä½œæ•°`15`æ”¾å…¥æ“ä½œæ•°æ ˆä¸­ï¼Œç„¶åå°†`PC`å¯„å­˜å™¨çš„å€¼ç½®ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œåœ°å€ï¼Œå³`2`ï¼›
3. å½“æ‰§è¡ŒæŒ‡ä»¤åœ°å€ä¸º`2`çš„æ“ä½œæŒ‡ä»¤æ—¶ï¼Œå°†æ“ä½œæ•°æ ˆä¸­çš„æ•°æ®å–å‡ºæ¥ï¼Œå­˜åˆ°å±€éƒ¨å˜é‡è¡¨çš„`1`ä½ç½®ï¼Œå› ä¸ºè¯¥æ–¹æ³•æ˜¯å®ä¾‹æ–¹æ³•ï¼Œæ‰€ä»¥`0`ä½ç½®å­˜çš„æ˜¯`this`çš„å€¼ï¼Œ`PC`å¯„å­˜å™¨ä¸­çš„å€¼å˜ä¸º`3`;
4. åŒæ­¥éª¤2å’Œ3å°†`8`å…ˆæ”¾å…¥æ“ä½œæ•°æ ˆï¼Œç„¶åå–å‡ºæ¥å­˜åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œ`PC`å¯„å­˜å™¨ä¸­çš„å€¼ä¹Ÿç”±`3`->`5`->`6`ï¼›
5. å½“æ‰§è¡Œåˆ°åœ°å€æŒ‡ä»¤ä¸º`6`ã€`7`ã€`8`æ—¶ï¼Œå°†å±€éƒ¨å˜é‡è¡¨ä¸­ç´¢å¼•ä½ç½®ä¸º`1`å’Œ`2`çš„æ•°æ®é‡æ–°åŠ è½½åˆ°æ“ä½œæ•°æ ˆä¸­å¹¶è¿›è¡Œ`iadd`åŠ æ“ä½œï¼Œå°†å¾—åˆ°çš„ç»“æœå€¼å­˜åˆ°æ“ä½œæ•°æ ˆä¸­ï¼Œ`PC`å¯„å­˜å™¨ä¸­çš„å€¼ä¹Ÿç”±`6`->`7`->`8`->`9`ï¼›
6. æ‰§è¡Œæ“ä½œæŒ‡ä»¤`istore_3`ï¼Œå°†æ“ä½œæ•°æ ˆä¸­çš„æ•°æ®å–å‡ºå­˜åˆ°å±€éƒ¨å˜é‡è¡¨ä¸­ç´¢å¼•ä¸º`3`çš„ä½ç½®ï¼Œæ‰§è¡Œ`return`æŒ‡ä»¤ï¼Œæ–¹æ³•ç»“æŸã€‚

**é¢è¯•å®˜:** å†…å¿ƒOSï¼šè¿™å°å­è²Œä¼¼è¿˜å¯ä»¥å‘€ã€‚è¯´çš„è¿˜ä¸é”™ï¼Œé‚£ä½ èƒ½è¯´ä¸€ä¸‹æ–¹æ³•ä¸­å®šä¹‰çš„å±€éƒ¨å˜é‡æ˜¯å¦çº¿ç¨‹å®‰å…¨å—ï¼Ÿ

**é˜¿Qï¼š** é‚£æˆ‘å†ç”¨å‡ ä¸ªä¾‹å­æ¥è¯´ä¸€ä¸‹å§ã€‚

```java
public class LocalParaSafeProblem {


    /**
     * çº¿ç¨‹å®‰å…¨çš„
     * è™½ç„¶StringBuilderæœ¬èº«çº¿ç¨‹ä¸å®‰å…¨ï¼Œ
     * ä½†s1 å˜é‡åªå­˜åœ¨äºè¿™ä¸ªæ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œ
     * å› ä¸ºæ ˆå¸§æ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„ä¸€ä»½ï¼Œ
     * æ‰€ä»¥è¿™é‡Œçš„s1æ˜¯çº¿ç¨‹å®‰å…¨çš„
     */
    public static void method01() {
        // çº¿ç¨‹å†…éƒ¨åˆ›å»ºçš„ï¼Œå±äºå±€éƒ¨å˜é‡
        StringBuilder s1 = new StringBuilder();
        s1.append("a");
        s1.append("b");
    }

    /**
     * çº¿ç¨‹ä¸å®‰å…¨
     * å› ä¸ºæ­¤æ—¶StringBuilderæ˜¯ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œ
     * å¤–éƒ¨çš„å…¶ä»–çº¿ç¨‹ä¹Ÿå¯ä»¥è®¿é—®ï¼Œæ‰€ä»¥çº¿ç¨‹ä¸å®‰å…¨
     */
    public static void method02(StringBuilder stringBuilder) {
        stringBuilder.append("a");
        stringBuilder.append("b");
    }

    /**
     * çº¿ç¨‹ä¸å®‰å…¨
     * æ­¤æ—¶StringBuilderè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œ
     */
    public static void method03() {
        StringBuilder stringBuilder = new StringBuilder();
        new Thread(() -> {
            stringBuilder.append("a");
            stringBuilder.append("b");
        }, "t1").start();

        method02(stringBuilder);
    }

    /**
     * çº¿ç¨‹ä¸å®‰å…¨
     * å› ä¸ºæ­¤æ—¶æ–¹æ³•å°†StringBuilderè¿”å›å‡ºå»äº†
     * å¤–é¢çš„å…¶ä»–çº¿ç¨‹å¯ä»¥ç›´æ¥ä¿®æ”¹StringBuilderè¿™ä¸ªå¼•ç”¨äº†æ‰€ä»¥ä¸å®‰å…¨
     */
    public static StringBuilder method04() {
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.append("a");
        stringBuilder.append("b");
        return stringBuilder;
    }


    /**
     * StringBuilderæ˜¯çº¿ç¨‹å®‰å…¨çš„
     * æ­¤æ—¶stringBuilderå€¼åœ¨å½“å‰æ ˆå¸§çš„å±€éƒ¨å˜é‡è¡¨ä¸­å­˜åœ¨ï¼Œ
     * å…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®åˆ°è¯¥å¼•ç”¨ï¼Œ
     * æ–¹æ³•æ‰§è¡Œå®Œæˆä¹‹åæ­¤æ—¶å±€éƒ¨å˜é‡è¡¨ä¸­çš„stringBuilderçš„å°±é”€æ¯äº†
     * è¿”å›çš„stringBuilder.toString()çº¿ç¨‹ä¸å®‰å…¨
     * æœ€åçš„è¿”å›å€¼å°†toStringè¿”å›ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥æ“ä½œè€ŒStringæœ¬èº«æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚
     */
    public static String method05() {
        StringBuilder stringBuilder = new StringBuilder();
        stringBuilder.append("a");
        stringBuilder.append("b");
        return stringBuilder.toString();
    }
}
```

çœ‹åˆ°è¿™ä¼°è®¡ä¼šæœ‰ç‚¹ç»•ï¼Œé‚£æˆ‘å°±æ€»ç»“ä¸€ä¸‹å§ï¼šå¦‚æœå¯¹è±¡æ˜¯åœ¨æ–¹æ³•å†…éƒ¨äº§ç”Ÿä¸”åœ¨å†…éƒ¨æ¶ˆäº¡ï¼Œä¸ä¼šè¿”å›åˆ°å¤–éƒ¨å°±ä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›åä¹‹å¦‚æœç±»æœ¬èº«çº¿ç¨‹ä¸å®‰å…¨çš„è¯å°±å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

**é¢è¯•å®˜ï¼š** ä¸é”™ä¸é”™ï¼Œæœ‰ç†æœ‰æ®ï¼Œé‚£ä½ å†è¯´è¯´ä½ å¯¹å †å†…å­˜çš„ç†è§£å§ã€‚

**é˜¿Qï¼š** å”‰ï¼Œä»Šå¤©å¤ªç´¯äº†ï¼Œè¯´äº†ä¸€å¤©è¿™ä¸ªäº†ï¼Œä¸æƒ³è¯´äº†ã€‚

**é¢è¯•å®˜ï¼š** é‚£å¥½å§ï¼Œé‚£æˆ‘ä»¬ä»Šå¤©å…ˆåˆ°è¿™å§ï¼Œå›å»ç­‰é€šçŸ¥å§ã€‚